<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes - Minha ManhwaTeca</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="container">
            <a href="/" class="back-link">&larr; Voltar para a Lista</a>
        </div>
    </header>

    <main class="container">
        <article class="detalhes-manhwa">
            <div class="detalhes-capa">
                <img src="<%= manhwa.capa %>" alt="<%= manhwa.titulos[0] %>">
            </div>
            <div class="detalhes-info">
                <div class="titulo-principal-container">
                    <h1><%= manhwa.titulos[0] %></h1>
                    <button id="btn-abrir-modal-atualizar" class="btn-icon btn-atualizar" title="Atualizar informações do Manhwa">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="titulos-secundarios">
                    <% for (let i = 1; i < manhwa.titulos.length; i++) {
                        const titulo = manhwa.titulos[i];
                        %>
                        <span><%= titulo %></span>
                    <% } %>
                </div>
                <div class="meta-info">
                    <span><strong>Status:</strong> <%= manhwa.status %></span>
                    <span><strong>Capítulos:</strong> <%= manhwa.capitulos %></span>
                </div>
                
                <div class="links">
                    <table>
                        <thead>
                            <tr>
                                <th class="coluna-pequena">Idioma</th>
                                <th>Link</th>
                                <th class="coluna-pequena">Capítulo atual</th>
                                <th>Total</th>

                            </tr>
                        </thead>
                        <tbody>
                            
                            <% manhwa.links.forEach(link => { %>
                                <tr>
                                    <th class="coluna-pequena">
                                        <%= link.idioma %>
                                    </th>
                                    <th> <a href="<%= link.url %>" target="_blank" rel="noopener noreferrer"><%= link.url %></a></th>
                                    <th class="coluna-pequena">
                                        <div class="chapter-control">
                                            <button class="btn-cap" >-</button>
                                            <select name="cap-atual" class="select-invisivel select-cap-atual" data-manhwa-slug="<%= manhwa.slug %>" data-link-url="<%= link.url %>">
                                                <% for( let index = 0; index < link.cap_total; index++ ) { %>
                                                    <option value="<%= index + 1 %>" <% if (index + 1 === link.cap_atual) { %> selected <% } %> ><%= index + 1 %></option>
                                                    <% } %>
                                            </select>
                                            <span class="save-status"></span>
                                            <button class="btn-cap" data-cap-total ="<%= link.cap_total %>">+</button>
                                        </div>
                                        
                                    </th>
                                    <th class="coluna-pequena"><%= link.cap_total %></th>
                                    <th class="coluna-delete">
                                        <button class="btn-delete">&times;</button>
                                    </th>
                                </tr>
                            <% }) %>

                            
                        </tbody>
                    </table>
                </div>
                <div class="action-buttons">
                    <a href="#" id="btn-abrir-modal-link" class="btn-secondary">Adicionar Link</a>
                </div>

                <!-- MODAL PARA ADICIONAR LINK -->
                <div id="modal-adicionar-link" class="modal-overlay">
                    <div class="modal-content">
                        <header class="modal-header">
                            <h2>Adicionar Novo Link</h2>
                            <button id="btn-fechar-modal-link" class="btn-close">&times;</button>
                        </header>
                        
                        <form action="/manhwa/adicionar-link" method="POST" class="form-manhwa">
                            <input type="hidden" name="manhwaSlug" value="<%= manhwa.slug %>">

                            <div class="form-group">
                                <label for="idioma">Idioma</label>
                                <select id="idioma" name="idioma" class="select-invisivel" style="color-scheme: dark;">
                                    <option value="PT">PT</option>
                                    <option value="EN">EN</option>
                                    <option value="ES">ES</option>
                                    <option value="CH">CH</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="url">URL do Link</label>
                                <input type="url" id="url" name="url" placeholder="https://..." required>
                            </div>
                            <div class="form-group">
                                <label for="cap_total">Caps. Totais</label>
                                <input type="number" id="cap_total" name="cap_total" min="1" value="100" required>
                            </div>
                            <button type="submit" class="btn-primary">Adicionar</button>
                        </form>
                    </div>
                </div>
            </div>
        </article>
        
        <!-- MODAL DE FORMULÁRIO PARA ATUALIZAR MANHWA -->
        <%- include('partials/modal-manwha', {
            modalTitulo: "Atualizar Manhwa",
            actionForm: `/manhwa/atualizar/${manhwa.slug}`,
            textBotao: "Atualizar Manhwa",
            manhwa: manhwa
        }) %>

    </main>
        
    <footer>
        <p>&copy; 2025 - Criado por <strong>Álisson</strong> com ❤️ para <strong>Emilin</strong></p>
    </footer>

    <script src="/js/toast.js"></script>
    <script src="/js/main.js"></script>

</body>
</html>